{% load staticfiles %}

<script> 

var map;
var mapBounds = new google.maps.LatLngBounds(
  new google.maps.LatLng(40.5840806224, -129.0),
  new google.maps.LatLng(47.499, -123.726199391));
var mapMinZoom = 4;
var mapMaxZoom = 10;

var overlayList = [
 {% for item in overlays %}
"{{item.function_name}}",
 {% endfor %}
 ];

 var layers = []

for (i in overlayList){

  layers[i] = new google.maps.ImageMapType({
    getTileUrl: function(coord, zoom) { 
      var proj = map.getProjection();
      var tileSize = 256 / Math.pow(2,zoom);
      var tileBounds = new google.maps.LatLngBounds(
              proj.fromPointToLatLng(new google.maps.Point(coord.x*tileSize, (coord.y+1)*tileSize)),
        proj.fromPointToLatLng(new google.maps.Point((coord.x+1)*tileSize, coord.y*tileSize))
          );
          if (mapBounds.intersects(tileBounds) && (zoom >= mapMinZoom) && (zoom <= mapMaxZoom))
        return "{% static 'tiles/'%}" +overlayList[i]+"/" +
        + zoom + "/" + coord.x + "/" + (Math.pow(2,zoom)-coord.y-1) + ".png";
          else
              return "http://www.maptiler.org/img/none.png";
    },
    tileSize: new google.maps.Size(256, 256),
    isPng: true
  });

}

function initialize() {

  var mapOptions = {
    panControl: true,

    zoomControl: true,
    mapTypeControl: false,
    scaleControl: false,
    streetViewControl: false,
    overviewMapControl: false,
    draggableCursor: 'crosshair'

  }



  map = new google.maps.Map(document.getElementById("map_canvas"),mapOptions);

   var emptyDiv = document.createElement('div');
    emptyDiv.className = 'empty';
    emptyDiv.index = 0;

    map.controls[google.maps.ControlPosition.TOP_LEFT].push(emptyDiv);

  google.maps.event.addListener(map, 'mousemove', function(event) {

    $("#coords-lat").html("lat:" + event.latLng.lat());
     $("#coords-lon").html("lon:" + event.latLng.lng());

  });



  map.fitBounds(mapBounds);
  map.setMapTypeId('satellite');

  for (i in overlayList){
    map.overlayMapTypes.insertAt(i, layers[0]);
  }
}

</script> 