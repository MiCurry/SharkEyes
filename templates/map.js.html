{% load staticfiles %}

<script>

// global variables
var map;
var mapBounds = new google.maps.LatLngBounds(
  new google.maps.LatLng(40.5840806224, -129.0),
  new google.maps.LatLng(47.499, -123.726199391));
var mapMinZoom = 4;
var mapMaxZoom = 10;
var layers = [];




test = new google.maps.ImageMapType({
  getTileUrl: function(coord, zoom) {
    var proj = map.getProjection();
    var tileSize = 256 / Math.pow(2,zoom);
    var tileBounds = new google.maps.LatLngBounds(
            proj.fromPointToLatLng(new google.maps.Point(coord.x*tileSize, (coord.y+1)*tileSize)),
      proj.fromPointToLatLng(new google.maps.Point((coord.x+1)*tileSize, coord.y*tileSize))
        );
        if (mapBounds.intersects(tileBounds) && (zoom >= mapMinZoom) && (zoom <= mapMaxZoom))
      return "{% static 'tiles/'%}" +"salt_function"+"/" +
      + zoom + "/" + coord.x + "/" + (Math.pow(2,zoom)-coord.y-1) + ".png";

  },
  tileSize: new google.maps.Size(256, 256),
  isPng: true,
  opacity: .5
});



function initialize() {

  var mapOptions = {
    panControl: true,
    panControlOptions: {
        position: google.maps.ControlPosition.TOP_RIGHT
    },

    zoomControl: true,
    zoomControlOptions: {
        style: google.maps.ZoomControlStyle.LARGE,
        position: google.maps.ControlPosition.TOP_RIGHT
    },
    mapTypeControl: false,
    scaleControl: false,
    streetViewControl: false,
    overviewMapControl: false,
    draggableCursor: 'crosshair'

  }



  map = new google.maps.Map(document.getElementById("map_canvas"),mapOptions);


  grid = new Graticule(map, true);






  google.maps.event.addListener(map, 'mousemove', function(event) {

    $("#coords-lat").html("lat:  " + event.latLng.lat().toFixed(2));
     $("#coords-lon").html("lon:  " + event.latLng.lng().toFixed(2));

  });



  map.fitBounds(mapBounds);
  map.setMapTypeId('satellite');

var overlayList = [
 {% for item in overlays %}
"{{item.function_name}}",
 {% endfor %}
 ];


{% for item in overlays %}

    layers.push(
      new google.maps.ImageMapType({
        getTileUrl: function(coord, zoom) {
          var proj = map.getProjection();
          var tileSize = 256 / Math.pow(2,zoom);
          var tileBounds = new google.maps.LatLngBounds(
                  proj.fromPointToLatLng(new google.maps.Point(coord.x*tileSize, (coord.y+1)*tileSize)),
            proj.fromPointToLatLng(new google.maps.Point((coord.x+1)*tileSize, coord.y*tileSize))
              );
              if (mapBounds.intersects(tileBounds) && (zoom >= mapMinZoom) && (zoom <= mapMaxZoom))
            return "{% static 'tiles/'%}" +"{{item.function_name}}"+"/" +
            + zoom + "/" + coord.x + "/" + (Math.pow(2,zoom)-coord.y-1) + ".png";

        },
        tileSize: new google.maps.Size(256, 256),
        isPng: true,
        opacity: .5,
        hidden: true
    })

    );

{% endfor %}



//insert first overlay
/*
for (i in overlayList){
    map.overlayMapTypes.insertAt(i, layers[i]);
    map.overlayMapTypes.removeAt(i, layers[i]);
} */
map.overlayMapTypes.insertAt(0, layers[0]);


}

</script>
